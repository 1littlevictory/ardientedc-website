<!DOCTYPE html>
<html>

  <head>
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/classes/main.css">

    <head>
      <meta charset="utf-8">
      <title>Class Registration Form</title>

      <link rel="stylesheet" href="/css/global.css">
      <link rel="stylesheet" href="/css/classes/registration.css">
      <link rel="icon" type="image/png" href="/img/favicon.gif">
      <link href="https://fonts.googleapis.com/css?family=Lora|Dancing+Script|M+PLUS+1p|Alegreya+Sans+SC|Raleway|Montserrat:200|M+PLUS+1p:100|Lateef" rel="stylesheet">

      <script src="/js/jquery-3.3.1.min.js"></script>

      <script type="text/javascript">
        $(document).ready(function() {
          console.log('startTimeFmt', '<%= startTimeFmt %>');
          $('.userform form').on('submit', function(e) {
            //$('.userform button').on('click', function(e) {
            console.log('user form submitted')
            e.preventDefault();
            for (field of ['fullname', 'email', 'date']) {
              $(`.payment p .${field}`).text($(`.userform .input[name="${field}"]`).val());
            }
            $('.form-container .userform').hide();
            $('.form-container .payment input[type="checkbox"]').get(0).checked = false; // always require them to check it
            $('.form-container .payment .user-confirm').fadeIn()
            /* TODO: add "edit" button to go back to .userform. and a confirm check box -> lets paypal button appear*/
            /*TODO: copy the info to the jotform and submit, also process payment.*/
          })

          $('.cancel').on('click', function(e) {
            var ok = confirm("Are you sure you want to canel your registration?");
            if (ok == true) {
              // leave registration and go back to main class page
              return true
            } else {
              // stay on page
              e.preventDefault();
            }
          })
          $('.edit').on('click', function(e) {
            e.preventDefault();
            $('.form-container .payment .user-confirm').hide();
            $('.form-container .payment form').hide();
            $('.form-container .userform').fadeIn();
          })

          $('.form-container .payment input[type="checkbox"]').change(function() {
            if ($(this).is(':checked')) {
              // show the paypal button
              $('.form-container .payment form').fadeIn();
            } else {
              $('.form-container .payment form').hide();
            }
          })
        })
      </script>
    </head>

    <body>
      <header>
        <nav>
          <a href="/">Home</a> |
          <a href="/events">Events</a> |
          <a href="/classes">Classes</a>
        </nav>
      </header>
      <main>
        <h1>Register for:</h1>
        <h2><%= title %></h2>
        <section class="img-container">
          <!-- style="background-image: url('/img/classes/<%= id %>.jpg');"-->
          <img src="/img/classes/<%= id %>.jpg" alt="">

        </section>
        <section class="form-container">
          <article class="userform">
            <h3>Sign up here</h3>

            <form action="" method="post">

              <label for="name">Your name</label>
              <input class="input" type="text" name="fullname" value="">

              <label for="date">Select Date</label>
              <select class="input" name="date">
              <!-- TODO: might make these buttons-->
              <option value="0" disabled >=== Choose a date ===</option>
              <% for(var i=0; i < availableDates.length; i++) { %>
                <option value="<%= availableDates[i][0] %>"
                   <%if (availableDates[i][2] == 1) { %> title="Class cancelled on this day" disabled  <% } %> ><%= availableDates[i][1] %></option>
              <% } %>
              </select>


              <input class="input" type="hidden" name="time" value="<%= startTime %>" readonly>

              <label for="email">Email address</label>
              <input class="input" type="email" name="email" value="">

              <!-- later support buying more than 1 pass -->
              <input class="input" type="hidden" name="quantity" value="1">

              <!-- info to set to jotform -->
              <input class="input" type="hidden" name="instructor" value="<%= instructor %>">

              <div class="classinfo">
                <label for="time">Class Time</label>
                <p>
                  <%= startTimeFmt %>
                </p>
              </div>
              <div class="address classinfo">
                <label for="locationName">Location and Address</label>
                <h5><%= locationName %></h5>
                <p>
                  <%= locationAddress %>
                </p>
                <input class="input" type="hidden" name="locationName" value="<%= locationName %>">
                <input class="input" type="hidden" name="locationAddress" value="<%= locationAddress %>">
              </div>
              <div class="price classinfo">
                <label for="price">Price</label>
                <p>$
                  <%= price %>
                </p>
                <input class="input" type="hidden" name="price" value="<%= price %>">
              </div>


              <input type="submit" name="saveinfo" value="Save info and pay">
              <a class="cancel" href="/classes"><button type="button" name="cancel">Cancel registration</button></a>

            </form>


          </article>


          <article class="payment">

            <div class="user-confirm">
              <h3>Confirm your registration, and submit payment</h3>
              <p> Name: <span class="fullname"></span></p>
              <p> Email address <span class="email"></span></p>
              <p> Class Date <span class="date"></span></p>
              <p> Class Time <span class="time"><%= startTimeFmt %></span></p>
              <p> Price: <span class="price"><%= price %></span></p>
              <div class="address">
                <label>Class Location and Address</label>
                <h5><%= locationName %></h5>
                <p>
                  <%= locationAddress %>
                </p>
              </div>
              <a class="edit" href="#">Edit info</a>
              <input type="checkbox" name="confirm" value=unchecked><span>I confirm my information is correct</span>
            </div>

            <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
              <input type="hidden" name="cmd" value="_s-xclick">
              <input type="hidden" name="notify_url" value="/registration/<%= id %>/<%= orderid %>">
              <!-- TODO notify_url should holdfully wourl when server has been deployed -->
              <input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----
            ">
              <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_buynowCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
              <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
            </form>
          </article>

        </section>


      </main>



      <footer>
      </footer>
    </body>

</html>